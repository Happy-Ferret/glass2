<!doctype html>
<html>
<head>

    <meta charset="utf-8">
    <title>Desktop</title>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link href="../system/design/core.css" rel="stylesheet">
    <link href="../system/design/desktop.css" rel="stylesheet">
    <link href="../system/design/ventus.css" rel="stylesheet">
    <link href="../system/design/windows.css" rel="stylesheet">
    <link href="../system/design/toolbar.css" rel="stylesheet">

    <link href="../node_modules/angular-material/angular-material.min.css" rel="stylesheet">
    <link href="../node_modules/jquery-ui-dist/jquery-ui.min.css" rel="stylesheet">

    <script src="../node_modules/angular/angular.js"></script>
    <script src="../node_modules/angular-aria/angular-aria.js"></script>
    <script src="../node_modules/angular-animate/angular-animate.js"></script>
    <script src="../node_modules/angular-material/angular-material.js"></script>
    <script src="../node_modules/angular-material-icons/angular-material-icons.js"></script>

    <style>

        body {
            display: none;
            background: url(../users/kurisu/wallpaper.png) no-repeat center center fixed;
        }

    </style>

    <script>

        window.$ = window.jQuery = require("jquery")
        window._ = require("lodash")

        const remote = require("electron").remote
        const moment = require("moment")
        const color = require("tinycolor2")
        require("../system/core/ventus")
        const Ventus = window.Ventus

        angular.module("desktop", ["ngMaterial", "ngMdIcons"])
            .controller("desktop", ($scope) => { })

        function newWin() {
            let webview = $("<webview style='height:100%' src='http://google.com'></webview>")

            webview.on("did-change-theme-color", (e) => {
                let theme = e.originalEvent.themeColor
                win.$titlebar.css("background-color", theme)

                if (color(theme).isDark()) win.$titlebar.addClass("light")
                console.log(theme)
                console.log(color(theme).isDark())
                console.log(win.$titlebar)
            })

            let win = wm.createWindow({
                title: "Browser",
                width: 400,
                height: 280,
                content: webview
            })

            win.open()
        }

        $(function() {
            setTimeout(() => $("body").fadeIn(250), 200)
            setInterval(() => $("#clock").text(moment().format("h:mm A")), 150)

            window.wm = new Ventus.WindowManager()
        })

    </script>

</head>
<body class="desktop" ng-app="desktop" ng-controller="desktop" ng-cloak>

    <div class="notifications"></div>

    <div class="toolbar">
        <div class="apps">
            <span id="app_launcher"><i class="material-icons">apps</i></span>
            <span id="app_browser" onclick="newWin()"><i class="material-icons">public</i></span>
        </div>

        <div class="tray">
            <span id="clock">__:__</span>
        </div>
    </div>

</body>
</html>
